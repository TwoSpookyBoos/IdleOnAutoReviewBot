from utils.logging import get_consts_logger
from utils.number_formatting import parse_number

logger = get_consts_logger(__name__)

# `Spelunky` in source. Last updated in v2.45 Nov 16
# make sure to manually turn `.split("")` into `.split(" ")` and add spaces between each value
Spelunky = ["3 4 5 6 7 8 9 10 10 10 11 11 12 12 12".split(" "), "Name0 Name0 Name0 Name0 Name0 Name0 Name0 Name0 Name0 Name0 Name0 Name0".split(" "), "$%_Stamina_Returned NA Stamina_Shield_Active $%_Bonus_Amber $x_Total_POW $_Booms_Left $%_Chance_for_2x_Amber Shadower_Mach_$ NA 5x_Grand_Discoveries NA NA $x_Extra_Amber".split(" "), "2 10 2 1 2 3 1 1 4 1 1 1".split(" "), "255,206,70 241,179,187 129,255,255 255,163,73 190,255,90 235,115,7 188,255,189 214,145,255 255,230,136 249,241,179 255,75,69 255,116,239".split(" "), "Amber Prisma_Bubbles Exalted_Stamp_Frags Snail_Mail Blinding_Lantern Sigil_Syrup Spirit_Offering Strange_Gold_Piece Rockenstone Sheetmetal Popcorn Pillario".split(" "), "Pebble_Cove Sedimeadow Rustbelt_03 Blushpit Chucklemire Lunarheim Bizarrio Glitter_End Name9 Name10 Name11 Name12 Name13 Name14 Name15".split(" "), "6 10 19 29 39 49 69 99 54 59 64 69 79 100 120".split(" "), "0 0 0 0 0 0 0 0 0 0 0 0 0 0 0".split(" "), "0 0 0 0 0 0 0 0 0 0 0 0 0 0 0".split(" "), "23 40 50 60 85 130 35".split(" "), "1 2 4 7 15 50 250".split(" "), "1 2 3 4 7 15 25".split(" "), "Hammer Mace Mallet Flail Warhammer Scepter Mjolnir".split(" "), "World's_End_island_&_Omnipotent_Artifact_tier_unlocked_in_Sailing! Superbits_in_Gaming_now_has_a_2nd_page_full_of_new_upgrades! Cards_can_now_be_upgraded_to_6-Star_Majestic_quality! Unlocks_the_Exotic_Market_tab_&_Medal_seed_type_in_Farming! Teal_Summoning_is_now_available,_with_new_upgrades_and_opponents! +30_Max_LV_for_Cooking_Meals!_@_+1_Super_Talent_PTS!_@_+2_Gallery_Slots! Sigils_can_be_upgraded_a_4th_time_to_Ethereal!_@_Each_one_also_gives_+0.2%_Prisma_Bubble_Multi! This_lore_bonus_has_yet_to_be_fully_understood... 8 9 10 11 12 13 14".split(" "), "YOU_HAVE_NO_COLOURS_ON_YOUR_PALETTE!!!|Double_click_a_colour_to_start_growing_colourful_plants! Click_the_VIEW_button_in_the_top_right_to_see_Colour_Levels,|and_click_it_again_to_see_the_chance_to_level_them_up! You_level_up_colours_by_harvesting_plants_of_that_colour.|Doing_so_permanently_increases_their_bonus! All_colour_bonuses_are_permanent,_and_apply_to_all_characters,_always!|Yes,_even_when_the_colour_isn't_equipped! Highly_Evolved_plants_have_more_palette_luck!_More_Specifically,_starting_with_0_Evo:|1x_luck,_1.5x_luck,_2x_luck,_3x_luck,_5x_luck,_10x_luck,_25x_luck,_100x_luck! Plants_only_unlock_the_colours_next_to_its_own_colour_on_the_Palette_board. Palette_Luck_is_a_multiplier_boost_to_your_chance_of_finding_new_colours|and_your_chance_of_leveling_up_colours. Toggling_the_Palette_ON_and_OFF_will_auto_harvest_all|of_your_plants,_for_obvious_reasons...".split(" "), "For_the_current_player,_{%_of_all_stamina_used_is_given_right_back!_@_(Effect_wears_off_when_player_runs_out_of_Stamina) Highlights_an_area_on_the_floor._@_The_hole_to_the_next_depth_is_guaranteed_to_be_in_that_area! Gives_the_current_player_a_50%_chance_to_regenerate_@_{%_Stamina_when_they_run_out._@_(Cannot_be_used_a_2nd_time_while_the_effect_is_active) Boosts_your_amber_gain_by_+{%_per_stamina_used_during_the_delve_@_at_the_time_this_elixir_was_used._@_(Effect_persists_for_the_entire_Delve) Boosts_POW_to_5x_your_normal_amount._@_However,_you_now_lose_{%_POW_each_time_you_descend!_@_(Effect_persists_for_the_entire_Delve) For_the_next_2_depths,_whenever_an_object_is_destroyed_it_has_a_{%_chance_of_hitting_an_adjacent_object_with_the_power_of_your_Hammer_tool. All_objects_have_a_+{%_chance_of_dropping_Double_Amber_@_instead_of_a_single_amber_chunk_@_(Effect_lasts_for_the_entire_Delve) Shadow_Strikes_are_1.5x_more_common,_@_and_have_a_+{%_higher_chance_to_trigger_a_multi_strike_@_(Effect_lasts_for_the_entire_Delve) Triggers_a_Nova_Blast._Woah... Increases_Stamina_Costs_by_2x,_reduces_POW_by_100x,_but_boosts_Grand_Discovery_chance_by_5x This_elixir_doesn't_have_a_label_on_it._At_least,_that's_what_the_label_says... This_elixir_doesn't_have_a_label_on_it._At_least,_that's_what_the_label_says...".split(" "), "25 1 30 1 20 60 25 30 1 1 0 0".split(" "), "Advice_on_Life_and_Death,Well_uhh_dying_is_bad._@_+{%_faster_W7_mob_respawn_rate,10,26,filler Advice_on_Being_Tired,It_feels_better_to_not_be._@_+{%_Max_Stamina_in_Spelunking,8,29,filler Advice_on_Sleeping,Don't_do_it_while_awake._@_+{%_Spelunking_AFK_Gains,20,31,filler Advice_on_Murder_One,Only_do_it_in_video_games._@_+{%_Kill_per_Kill_in_W7,10,33,filler Advice_on_Being_Smart,Use_100%_of_your_brain._@_}x_Class_EXP_Gain,25,35,filler Advice_on_Materialism,Two_things_better_than_one_tbh._@_+{%_Double_Gold_Food_drop_chance,10,38,filler".split(" "), "241,614,301,5,3,4,0 500,500,999,4,4,0,0 826,732,305,4,7,0,0 1147,454,303,9,5,3,7 450,318,311,8,11,3,0 500,500,999,5,4,0,0 500,500,999,5,4,0,0 500,500,999,5,4,0,0 500,500,999,5,4,0,0 500,500,999,5,4,0,0".split(" "), "}x_Bones }x|Villager_EXP }x_Dust }x|Artifact_Find }x_Amber +{%|Palette_Luck }x_Tachyon +{%|W7_Skill_2 }x_Equinox +{%|W7_Skill_3 filler".split(" "), "420|7000 150|1000 750|6000 100|3000 400|15000 200|12000 600|5000 100|16000 220|5000 100|17000 500|5000".split(" "), "20 100 250 1000 3000 10000 25000 100000 500000".split(" "), "+{%_Daily_Reef_Coral +{%_Spelunking_POW +{%_Spelunking_Amber_gain }x_Class_EXP_gain +{%_who_knows +{%_who_knows +{%_who_knows +{%_who_knows +{%_who_knows".split(" "), "2 5 3 4 1 1 1 1 1".split(" "), "Lets_you_click_the_volcano,_linking_the_divinity_of_your_choice_to_ALL_players!_Also,_+{%_Divinity_EXP_gain_for_all! The_Max_Level_of_the_''Blessing''_upgrade_for_each_@_Divinity_is_+{_levels_higher! God_Rank_now_also_gives_}x_Class_EXP_to_all_players!_@_Total_Bonus:$x_Class_EXP Divinity_Skill_Lv_boosts_Minor_Link_Bonuses_a_bit_more!_@_(Your_Divinity_LV_of_$_boosts_Minor_Link_Bonuses_by_^x) Boosts_Divinity_PTS_gain_by_+{%_per_Coral_Reef_upgrade!_@_Total_Bonus:+$%_Divinity_PTS You_now_generate_{%_more_Daily_Coral_for_the_Coral_Reef_back_in_town!".split(" "), "39 7 38 14 35 2 13 3 18 5 4 9 23 33 37 1 16 25 36 0 20 31 19 17 15 32 11 12 27 8 6 34 30 26 21 10 28 29 22 24 40 41 42 43 44 45 46 47 48 49".split(" "), "Pearls_you_find_are_worth_$_instead_of_just_1 Increases_the_total_number_of_clams_on_the_map_to_$ Pearls_have_a_$%_chance_to_be_worth_10x_when_picked_up! Boosts_pearl_value_based_on_your_Multikill!_Currently_gives_}x All_upgrades_are_$%_cheaper Clams_now_drop_pure_pearls!_These_are_worth_$x_more_than_normal! Boosts_the_drop_rate_of_pearls_by_}x Increases_the_value_of_all_pearls_found_by_}x All_upgrades_are_}x_cheaper".split(" "), "1 1 3 1 12 50 10 10 16".split(" "), "1.20 5.0 1.50 1.4 1.15 1.5 1.35 1.25 1.22".split(" "), "+1_Grade_for_2_Gallery_Slots +1_Legend_Talent_PTS +10_LV/day_for_Kattlekruk_bubbles +5%_Meritocracy_Multi_bonus +1_Legend_Talent_PTS +20%_extra_Daily_Coral +15_LV/day_from_Brain_Coral +3%_Gallery_Bonus_Multi }x_Class_EXP_multi".split(" "), "Welcome_in,_I_trust_you're_ready_for_some_Spelunking!_@_Click_that_there_tunnel... Now,_select_your_crew_by_clicking_them_on_the_Right-Side_of_the_screen!_@_Let's_get_a_full_crew_of_3... Alright,_lets_go!_Click_ENTER_when_you're_ready! Click_on_the_rocks_until_you_find_the_way_down!_@_The_lore_boss_is_on_Depth_7..._@___@_(For_tutorial_purposes,_you_won't_lose_Stamina_yet) Hmmph..._yea_these_rocks_got_too_tough,_you_need_more_Spelunking_POW!_@___@_Use_up_all_your_Stamina,_then_lets_get_out_of_here... Now_then,_lets_go_to_the_shop_and_spend_the_orange_Amber_you_collected_from_those_rocks!_@_Click_the_SHOP_in_the_top_left... The_shopkeep_has_every_upgrade_under_lock_and_key,_so_you_need_to_pay_to_unlock_it_first._@_Select_the_upgrade_and_unlock_it! Now_you_can_actually_upgrade_it!_This_one_gives_POW,_which_is_what_we_need! Alright,_lets_get_outta_here_and_back_into_the_tunnel!_@___@_Click_LEAVE_in_the_top_right... Lets_get_back_in_there,_click_the_tunnel! You'll_need_to_choose_a_new_crew,_since_the_old_one_is_too_tired..._@_They'll_recover,_it'll_just_take_a_few_hours. This_time_we_aren't_stopping_until_we_find_and_defeat_the_Lore_Boss_on_Depth_7..._@_That's_how_you_get_new_juicy_bonuses_for_the_rest_of_IdleOn! AYE!_THERE_THEY_ARE,_TAKE_'EM_OUT!_@___@_Finish_the_delve_once_you_defeat_them! You_did_it!_Let's_check_out_what_awesome_IdleOn_bonus_you_got_from_defeating_the_Lore_Boss!_@_Click_that_LORE_button... Last_thing_now,_I_need_you_to_level_up_Spelunking._Go_stand_down_in_the_cave_right_outside_of_town,_and_wait..._come_back_here_once_you_level_up!".split(" ")]
spelunking_cave_bonus_descriptions = {
    index: desc.replace('_', ' ').replace('@', '').strip()
    for index, desc in enumerate(Spelunky[14])
}
spelunking_cave_names = {index: name.replace('_', ' ') for index, name in enumerate(Spelunky[6])}

# `CoralReef` in source. Last updated in v2.46 Dec 6
CoralReef = ["Every_day_you_play,_your_Grind_Time_bubble_gets_+{_LVs 15 10 1.25 243 0 274 22 324 19 31 171 389 _".split(" "), "Orange... 1 10 1.5 300 332 63 400 300 20 0 400 400 _".split(" "), "Adds_a_new_bonus_to_your_Tome's_Epilogue_in_World_4,_which_goes_up_with_your_Tome_Score! 10 15 1.65 236 328 248 350 309 25 0 479 381 _".split(" "), "Adds_a_new_mini_'Ninja_Knowledge'_upgrade,_level_it_up_with_your_Jade! 12 10 1.55 263 611 270 647 325 24 0 789 384 _".split(" "), "The_Gallery_gives_+{%_higher_bonuses,_@_and_has_+}_more_slots_for_Trophies 10 40 1.5 290 0 13 24 95 28 13 164 189 _".split(" "), "Blue... 1 10 1.5 300 615 52 400 300 20 0 400 400 _".split(" ")]
coral_reef_names = ['Brain Coral', 'Carnation Coral', 'Anemone Coral', 'Pillar Coral', 'Paragorgia Coral', 'Staghorn Coral']
coral_reef_bonuses = {
    coral_reef_names[index] : {
        'Description': decription.replace('_', ' ').replace('@', '').replace('+{', '').replace('+}', '').replace('%', ''),
        'Max Level': parse_number(max_level, -1),
        'Image': f'coral-{index}',
        'Coefficient': parse_number(coefficient, 0),
        'Exponent Base': parse_number(exponent_base, 0)
    }
    # all leftover `_` parts seem to be coordinates used when rendering
    for index, (decription, max_level, coefficient, exponent_base, _, _, _, _, _, _, _ ,_, _, _) in enumerate(CoralReef)
}

# 'LegendTalents' in source. Last updated in v2.46 Dec 6
LegendTalents = ["Coral_Restoration 2 30 filler +{%_Daily_Coral_gain +{%_more_Daily_Coral_gained_each_and_every_day!".split(" "), "Greatest_Drop_Party_Ever 4 500 filler +{%_Drop_Rate +{%_Drop_Rate_for_all_players!_@_This_bonus_is_additive,_not_a_multiplier.".split(" "), "Double_Aint_Enough 3 100 filler $x_Statue_and_Gold_Food_drops ''2x_Statue_and_Gold_Food_drops''_now_drop_in_bundles_of_$x_instead!".split(" "), "Extended_Database 3 10 filler +{_Max_LV_for_5th_column +{_Max_LV_for_5th_column_of_Farming_Land_Rank_Database".split(" "), "Familiar_Firesale 2 40 filler {%_chance_for_no_Familiar_cost_increase Whenever_you_buy_a_Summoning_Familiar,_there's_a_{%_chance_for_the_cost_to_not_go_up_at_all..._almost_like_it's_free!)".split(" "), "Kruk_be_Bubblin' 5 10 filler +{_LVs_per_day_from_Kattlekruk Kattlekruk_gives_+{_more_Bubble_LVs_per_day_for_each_of_his_bubbles".split(" "), "The_Charms_got_Rizz 2 25 filler }x_higher_bonuses All_of_your_Gold_Charms_in_Sneaking_give_}x_higher_bonuses".split(" "), "Super_Duper_Talents 5 10 filler +{_LVs Super_Talent_PTS_give_+{_more_LVs_to_talents_than_they_normally_do".split(" "), "Buy_One_Get_One_Free 2 100 filler }x_more_LVs Get_}x_more_LVs_when_buying_Exotic_Market_upgrades".split(" "), "Superb_Gallerium 2 2 filler {_showcase_slots_are_1_grade_higher The_first_{_normal_showcase_slots_in_your_Gallery_are_1_grade_higher_(i.e._they_become_Featured,_and_give_150%_bonuses)".split(" "), "Picasso_Gaming 2 50 filler }x_higher_Palette_bonuses All_the_bonuses_from_your_Gaming_Palette_colours_are_}x_higher".split(" "), "Davey_Jones_Returns 4 15 filler }x_higher_bonuses,_and_{%_less_minimum_time }x_bonus_to_all_the_same_stats_that_'Davey_Jones_Training'_gives,_check_it_in_W5_Gemshop._Also,_-{%_Minimum_Travel_Time".split(" "), "Opa_Opal_Style 3 100 filler }x_Villager_EXP_gains Villagers_at_the_Hole_in_World_5_gain_}x_more_EXP".split(" "), "Blue_Ribbon_Certification 4 1 filler +{_more_daily_Ribbons Get_+{_more_Ribbons_every_day_for_your_Ribbon_Shelf_in_Cooking".split(" "), "Recycled_Particle_Upgrades 1 100 filler {%_of_unspent_upgrades_are_spent {%_of_Unspent_'Alternate_Particle_Upgrades'_each_day_are_spent_equally_across_the_1st_bubbles_of_each_colour,_for_free!".split(" "), "Reduced_Jail_Sentence 2 150 filler }x_Lab_and_Divinity_EXP_gain }x_higher_EXP_gain_for_both_Laboratory_and_Divinity".split(" "), "Thanatos's_Teachings 2 200 filler +{%_extra_kills +{%_extra_kills,_for_opening_portals_and_Deathnote._@_This_bonus_is_additive,_not_a_multiplier.".split(" "), "Yet_Another_Printer_Multi 2 5 filler +{%_daily_printer_output,_maxed_out_at_20_days +{%_printer_output_every_day_for_20_days,_resets_when_taking_a_new_sample!".split(" "), "Cog_Lover 2 2 filler +{_daily_Jeweled_Cog_claims You_can_claim_+{_more_Jeweled_Cogs_every_day,_if_you_have_them_unlocked...".split(" "), "More_Soot_More_Salt 2 75 filler }x_faster_Refinery_cycles Refinery_cycles_are_}x_faster".split(" "), "Skillium_Fancyson 4 75 filler }x_Skill_EXP_gain }x_higher_EXP_gain_for_all_skills,_all_of_them!".split(" "), "Flopping_a_Full_House 5 15 filler }x_Active_Card_bonuses Actively_equipped_cards_give_}x_higher_bonuses,_and_this_stacks_with_Lab_chips!".split(" "), "Democracy_FTW 1 25 filler +{%_higher_Ballot_Bonus The_Bonus_Ballot_gives_a_+{%_higher_bonus_for_the_winning_bonus_of_the_week".split(" "), "Daily_Shopping_Spree 3 8 filler +{_daily_cheap_upgrades The_first_{_upgrades_you_buy_each_day_for_Masterclasses_are_80%_cheaper".split(" "), "May_the_Best_Man_Win 1 20 filler +{%_higher_Meritocracy_Multi The_Multi_Meritocracy_gives_a_+{%_higher_multiplier_for_the_winning_bonus_of_the_week".split(" "), "Midusian_Appetite 3 500 filler +{%_Golden_Food_bonus +{%_total_Golden_Food_bonus._@_This_bonus_is_additive,_not_a_multiplier.".split(" "), "Furry_Friends_Forever 2 200 filler }x_bigger_'rest-of-the-game'_bonuses The_'rest-of-the-game'_bonuses_from_your_friends_Orion_and_Poppy_are_all_}x_bigger".split(" "), "Best_Story_Ever_Told 3 50 filler }x_higher_Reward_Multi }x_higher_Reward_Multi_for_all_Monument_Stories_in_the_W5_caverns._Also,_reward_multi's_build_up_for_an_extra_+{_hours!".split(" "), "+1_Slab 2 15 filler }x_bigger_Slab_bonuses The_Slab_in_World_5_gives_}x_bigger_bonuses".split(" "), "Whats_in_your_Jar? 2 20 filler }x_collectible_bonuses }x_higher_bonuses_from_all_of_your_Jar_Collectibles_in_Cavern_11".split(" "), "Lightning_Fast_Naps 2 25 filler }x_faster_Stamina_Regen }x_faster_Stamina_regeneration_for_Spelunking".split(" "), "Big_Sig_Fig 3 150 filler }x_Sigil_level_up_speed All_your_Sigils_in_Alchemy_level_up_}x_faster_than_normal".split(" "), "Purebred_Eggs 1 900 filler }x_Breeding_Egg_luck The_chance_for_eggs_in_Breeding_to_rank_up,_which_remember_gives_higher_pet_power,_is_}x_higher_than_normal!".split(" "), "Inevitable_Builder 2 75 filler }x_Trimmed_slot_build_speed Gives_1_additional_Trimmed_Construction_Slot,_and_makes_them_}x_faster_for_a_total_bonus_speed_of_$x!".split(" "), "Blessed_Be_Thy_Luck 2 100 filler }x_better_Blessing_luck }x_better_luck_when_using_Blessings_in_your_Sneaking_inventory".split(" "), "Obsolete_No_More 1 1 filler All_them_big_words_above_will_become_true The_Metal_Detector_bonus_from_Equinox_Valley_no_longer_resets_when_you_find_a_new_best_nugget".split(" "), "Wowa_Woowa 5 3 filler +{%_higher_Prisma_and_Exalted_bonuses The_bonus_from_Prisma_Bubbles_and_Exalted_Stamps_is_+{%_higher".split(" "), "6_O'Clock_Crystals 1 2000 filler }x_more_Daily_Guaranteed_Crystal_Mobs You_know_how_you're_guaranteed_to_spawn_$_Crystal_Mobs_every_day?_Well_that'll_be_}x_higher_with_this_talent!".split(" "), "Shrine_World_Order_Bill 1 1 filler All_7_Worlds_will_ratify_this_bill_into_the_IdleOn_constitution Introduces_a_bill_to_congress_that_will_make_Shrines_gain_EXP_from_AFK_gains_no_matter_what_world_you're_in!".split(" "), "Super_Talent_Points 1 1 filler Unlocks_this_system_for_all_characters! You_get_+1_Super_Talent_Point_at_Class_LV_500,_LV_600,_LV_700_and_so_on._Spend_these_on_Talents_to_give_them_+$_LV!".split(" "), "filler 1 filler filler filler I_have_not_yet_considered_this_talent...".split(" "), "filler 1 filler filler filler I_have_not_yet_considered_this_talent...".split(" "), "filler 1 filler filler filler I_have_not_yet_considered_this_talent...".split(" "), "filler 1 filler filler filler I_have_not_yet_considered_this_talent...".split(" "), "filler 1 filler filler filler I_have_not_yet_considered_this_talent...".split(" "), "filler 1 filler filler filler I_have_not_yet_considered_this_talent...".split(" "), "filler 1 filler filler filler I_have_not_yet_considered_this_talent...".split(" "), "filler 1 filler filler filler I_have_not_yet_considered_this_talent...".split(" "), "filler 1 filler filler filler I_have_not_yet_considered_this_talent...".split(" "), "filler 1 filler filler filler I_have_not_yet_considered_this_talent...".split(" ")]
legend_talents_order = Spelunky[26]
legend_talents_bonuses = {
    name.replace('_', ' '): {
        'Max Level': parse_number(max_level, -1),
        'Base Value': parse_number(base_value, 0),
        'Bonus': bonus.replace('_', ' '),
        'Description': description.replace('_', ' ').replace('@ ', ''),
        'Image': f'legend-talent-{legend_talents_order.index(str(index))}',
        'Display Order': legend_talents_order.index(str(index))
    }
    for index, (name, max_level, base_value, _, bonus, description ) in enumerate(LegendTalents)
    if name.lower() != "filler"
}
