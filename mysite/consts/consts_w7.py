from consts.idleon.w7.spelunk import Spelunky

from utils.logging import get_consts_logger
from utils.number_formatting import parse_number

logger = get_consts_logger(__name__)

# `CoralReef` in source. Last updated in v2.46 Dec 6
CoralReef = ["Every_day_you_play,_your_Grind_Time_bubble_gets_+{_LVs 15 10 1.25 243 0 274 22 324 19 31 171 389 _".split(" "), "Orange... 1 10 1.5 300 332 63 400 300 20 0 400 400 _".split(" "), "Adds_a_new_bonus_to_your_Tome's_Epilogue_in_World_4,_which_goes_up_with_your_Tome_Score! 10 15 1.65 236 328 248 350 309 25 0 479 381 _".split(" "), "Adds_a_new_mini_'Ninja_Knowledge'_upgrade,_level_it_up_with_your_Jade! 12 10 1.55 263 611 270 647 325 24 0 789 384 _".split(" "), "The_Gallery_gives_+{%_higher_bonuses,_@_and_has_+}_more_slots_for_Trophies 10 40 1.5 290 0 13 24 95 28 13 164 189 _".split(" "), "Blue... 1 10 1.5 300 615 52 400 300 20 0 400 400 _".split(" ")]
coral_reef_names = ['Brain Coral', 'Carnation Coral', 'Anemone Coral', 'Pillar Coral', 'Paragorgia Coral', 'Staghorn Coral']
coral_reef_bonuses = {
    coral_reef_names[index] : {
        'Description': decription.replace('_', ' ').replace('@', '').replace('+{', '').replace('+}', '').replace('%', ''),
        'Max Level': parse_number(max_level, -1),
        'Image': f'coral-{index}',
        'Coefficient': parse_number(coefficient, 0),
        'Exponent Base': parse_number(exponent_base, 0)
    }
    # all leftover `_` parts seem to be coordinates used when rendering
    for index, (decription, max_level, coefficient, exponent_base, _, _, _, _, _, _, _ ,_, _, _) in enumerate(CoralReef)
}

# 'LegendTalents' in source. Last updated in v2.46 Dec 6
LegendTalents = ["Coral_Restoration 2 30 filler +{%_Daily_Coral_gain +{%_more_Daily_Coral_gained_each_and_every_day!".split(" "), "Greatest_Drop_Party_Ever 4 500 filler +{%_Drop_Rate +{%_Drop_Rate_for_all_players!_@_This_bonus_is_additive,_not_a_multiplier.".split(" "), "Double_Aint_Enough 3 100 filler $x_Statue_and_Gold_Food_drops ''2x_Statue_and_Gold_Food_drops''_now_drop_in_bundles_of_$x_instead!".split(" "), "Extended_Database 3 10 filler +{_Max_LV_for_5th_column +{_Max_LV_for_5th_column_of_Farming_Land_Rank_Database".split(" "), "Familiar_Firesale 2 40 filler {%_chance_for_no_Familiar_cost_increase Whenever_you_buy_a_Summoning_Familiar,_there's_a_{%_chance_for_the_cost_to_not_go_up_at_all..._almost_like_it's_free!)".split(" "), "Kruk_be_Bubblin' 5 10 filler +{_LVs_per_day_from_Kattlekruk Kattlekruk_gives_+{_more_Bubble_LVs_per_day_for_each_of_his_bubbles".split(" "), "The_Charms_got_Rizz 2 25 filler }x_higher_bonuses All_of_your_Gold_Charms_in_Sneaking_give_}x_higher_bonuses".split(" "), "Super_Duper_Talents 5 10 filler +{_LVs Super_Talent_PTS_give_+{_more_LVs_to_talents_than_they_normally_do".split(" "), "Buy_One_Get_One_Free 2 100 filler }x_more_LVs Get_}x_more_LVs_when_buying_Exotic_Market_upgrades".split(" "), "Superb_Gallerium 2 2 filler {_showcase_slots_are_1_grade_higher The_first_{_normal_showcase_slots_in_your_Gallery_are_1_grade_higher_(i.e._they_become_Featured,_and_give_150%_bonuses)".split(" "), "Picasso_Gaming 2 50 filler }x_higher_Palette_bonuses All_the_bonuses_from_your_Gaming_Palette_colours_are_}x_higher".split(" "), "Davey_Jones_Returns 4 15 filler }x_higher_bonuses,_and_{%_less_minimum_time }x_bonus_to_all_the_same_stats_that_'Davey_Jones_Training'_gives,_check_it_in_W5_Gemshop._Also,_-{%_Minimum_Travel_Time".split(" "), "Opa_Opal_Style 3 100 filler }x_Villager_EXP_gains Villagers_at_the_Hole_in_World_5_gain_}x_more_EXP".split(" "), "Blue_Ribbon_Certification 4 1 filler +{_more_daily_Ribbons Get_+{_more_Ribbons_every_day_for_your_Ribbon_Shelf_in_Cooking".split(" "), "Recycled_Particle_Upgrades 1 100 filler {%_of_unspent_upgrades_are_spent {%_of_Unspent_'Alternate_Particle_Upgrades'_each_day_are_spent_equally_across_the_1st_bubbles_of_each_colour,_for_free!".split(" "), "Reduced_Jail_Sentence 2 150 filler }x_Lab_and_Divinity_EXP_gain }x_higher_EXP_gain_for_both_Laboratory_and_Divinity".split(" "), "Thanatos's_Teachings 2 200 filler +{%_extra_kills +{%_extra_kills,_for_opening_portals_and_Deathnote._@_This_bonus_is_additive,_not_a_multiplier.".split(" "), "Yet_Another_Printer_Multi 2 5 filler +{%_daily_printer_output,_maxed_out_at_20_days +{%_printer_output_every_day_for_20_days,_resets_when_taking_a_new_sample!".split(" "), "Cog_Lover 2 2 filler +{_daily_Jeweled_Cog_claims You_can_claim_+{_more_Jeweled_Cogs_every_day,_if_you_have_them_unlocked...".split(" "), "More_Soot_More_Salt 2 75 filler }x_faster_Refinery_cycles Refinery_cycles_are_}x_faster".split(" "), "Skillium_Fancyson 4 75 filler }x_Skill_EXP_gain }x_higher_EXP_gain_for_all_skills,_all_of_them!".split(" "), "Flopping_a_Full_House 5 15 filler }x_Active_Card_bonuses Actively_equipped_cards_give_}x_higher_bonuses,_and_this_stacks_with_Lab_chips!".split(" "), "Democracy_FTW 1 25 filler +{%_higher_Ballot_Bonus The_Bonus_Ballot_gives_a_+{%_higher_bonus_for_the_winning_bonus_of_the_week".split(" "), "Daily_Shopping_Spree 3 8 filler +{_daily_cheap_upgrades The_first_{_upgrades_you_buy_each_day_for_Masterclasses_are_80%_cheaper".split(" "), "May_the_Best_Man_Win 1 20 filler +{%_higher_Meritocracy_Multi The_Multi_Meritocracy_gives_a_+{%_higher_multiplier_for_the_winning_bonus_of_the_week".split(" "), "Midusian_Appetite 3 500 filler +{%_Golden_Food_bonus +{%_total_Golden_Food_bonus._@_This_bonus_is_additive,_not_a_multiplier.".split(" "), "Furry_Friends_Forever 2 200 filler }x_bigger_'rest-of-the-game'_bonuses The_'rest-of-the-game'_bonuses_from_your_friends_Orion_and_Poppy_are_all_}x_bigger".split(" "), "Best_Story_Ever_Told 3 50 filler }x_higher_Reward_Multi }x_higher_Reward_Multi_for_all_Monument_Stories_in_the_W5_caverns._Also,_reward_multi's_build_up_for_an_extra_+{_hours!".split(" "), "+1_Slab 2 15 filler }x_bigger_Slab_bonuses The_Slab_in_World_5_gives_}x_bigger_bonuses".split(" "), "Whats_in_your_Jar? 2 20 filler }x_collectible_bonuses }x_higher_bonuses_from_all_of_your_Jar_Collectibles_in_Cavern_11".split(" "), "Lightning_Fast_Naps 2 25 filler }x_faster_Stamina_Regen }x_faster_Stamina_regeneration_for_Spelunking".split(" "), "Big_Sig_Fig 3 150 filler }x_Sigil_level_up_speed All_your_Sigils_in_Alchemy_level_up_}x_faster_than_normal".split(" "), "Purebred_Eggs 1 900 filler }x_Breeding_Egg_luck The_chance_for_eggs_in_Breeding_to_rank_up,_which_remember_gives_higher_pet_power,_is_}x_higher_than_normal!".split(" "), "Inevitable_Builder 2 75 filler }x_Trimmed_slot_build_speed Gives_1_additional_Trimmed_Construction_Slot,_and_makes_them_}x_faster_for_a_total_bonus_speed_of_$x!".split(" "), "Blessed_Be_Thy_Luck 2 100 filler }x_better_Blessing_luck }x_better_luck_when_using_Blessings_in_your_Sneaking_inventory".split(" "), "Obsolete_No_More 1 1 filler All_them_big_words_above_will_become_true The_Metal_Detector_bonus_from_Equinox_Valley_no_longer_resets_when_you_find_a_new_best_nugget".split(" "), "Wowa_Woowa 5 3 filler +{%_higher_Prisma_and_Exalted_bonuses The_bonus_from_Prisma_Bubbles_and_Exalted_Stamps_is_+{%_higher".split(" "), "6_O'Clock_Crystals 1 2000 filler }x_more_Daily_Guaranteed_Crystal_Mobs You_know_how_you're_guaranteed_to_spawn_$_Crystal_Mobs_every_day?_Well_that'll_be_}x_higher_with_this_talent!".split(" "), "Shrine_World_Order_Bill 1 1 filler All_7_Worlds_will_ratify_this_bill_into_the_IdleOn_constitution Introduces_a_bill_to_congress_that_will_make_Shrines_gain_EXP_from_AFK_gains_no_matter_what_world_you're_in!".split(" "), "Super_Talent_Points 1 1 filler Unlocks_this_system_for_all_characters! You_get_+1_Super_Talent_Point_at_Class_LV_500,_LV_600,_LV_700_and_so_on._Spend_these_on_Talents_to_give_them_+$_LV!".split(" "), "filler 1 filler filler filler I_have_not_yet_considered_this_talent...".split(" "), "filler 1 filler filler filler I_have_not_yet_considered_this_talent...".split(" "), "filler 1 filler filler filler I_have_not_yet_considered_this_talent...".split(" "), "filler 1 filler filler filler I_have_not_yet_considered_this_talent...".split(" "), "filler 1 filler filler filler I_have_not_yet_considered_this_talent...".split(" "), "filler 1 filler filler filler I_have_not_yet_considered_this_talent...".split(" "), "filler 1 filler filler filler I_have_not_yet_considered_this_talent...".split(" "), "filler 1 filler filler filler I_have_not_yet_considered_this_talent...".split(" "), "filler 1 filler filler filler I_have_not_yet_considered_this_talent...".split(" "), "filler 1 filler filler filler I_have_not_yet_considered_this_talent...".split(" ")]
legend_talents_order = Spelunky[26]
legend_talents_bonuses = {
    name.replace('_', ' '): {
        'Max Level': parse_number(max_level, -1),
        'Base Value': parse_number(base_value, 0),
        'Bonus': bonus.replace('_', ' '),
        'Description': description.replace('_', ' ').replace('@ ', ''),
        'Image': f'legend-talent-{legend_talents_order.index(str(index))}',
        'Display Order': legend_talents_order.index(str(index))
    }
    for index, (name, max_level, base_value, _, bonus, description ) in enumerate(LegendTalents)
    if name.lower() != "filler"
}
